# go-ethereum-v1.11.5

## core/state_transition.go#L439

为什么要退？要这样退？

```go
if !rules.IsLondon {
    // Before EIP-3529: refunds were capped to gasUsed / 2
    // EIP-3529 之前退款上限为已用 gas 的一半
    st.refundGas(params.RefundQuotient)
} else {
    // After EIP-3529: refunds are capped to gasUsed / 5
    // EIP-3529 之后退款上限为已用 gas 的五分之一
    st.refundGas(params.RefundQuotientEIP3529)
}
```

## core/txpool/txpool.go#L767

待理解

```go 
// If the new transaction is a future transaction it should never churn pending transactions
if !isLocal && pool.isFuture(from, tx) {
    var replacesPending bool
    for _, dropTx := range drop {
        dropSender, _ := types.Sender(pool.signer, dropTx)
        if list := pool.pending[dropSender]; list != nil && list.Overlaps(dropTx) {
            replacesPending = true
            break
        }
    }
    // Add all transactions back to the priced queue
    if replacesPending {
        for _, dropTx := range drop {
            pool.priced.Put(dropTx, false)
        }
        log.Trace("Discarding future transaction replacing pending tx", "hash", hash)
        return false, ErrFutureReplacePending
    }
}
```

# state

![state](assets/02/state.png)

蓝色的矩形代表本模块
    database主要提供了trie树的抽象，提供trie树的缓存和合约代码长度的缓存。
    journal主要提供了操作日志，以及操作回滚的功能。
    state_object是account对象的抽象，提供了账户的一些功能。
    statedb主要是提供了state trie的部分功能。

core/state_processor.go#Process（？？static call和call区别）

# bloom
eth/bloombits.go
