# blockchain
blockchain（core/blockchain.go）主要功能是维护区块链的状态, 包括区块的验证,插入和状态查询。
主要流程：
    初始化区块链（core/blockchain.go#NewBlockChain）
        加载创世区块
        初始化验证器、预取器、区块处理器
        从磁盘加载最新状态
        验证区块和状态合法性
        验证区块头数据
        校验是否是预设的坏区块hash值（通常用来硬分叉）
        加载已有快照
        开始处理未来的区块（core/blockchain.go#procFutureBlocks）
            插入区块到链中（core/blockchain.go#InsertChain））
        交易索引构建和删除
    尝试将给定的区块插入到规范链中，或者创建一个分叉（core/blockchain.go#InsertChain）
        健壮性检查：链有序且连贯
        预检通过，开始导入区块（core/blockchain.go#insertChain）
            并行恢复区块签名
            并行验证区块头，调用一致性引擎校验区块头是否合法 （？？查看POW转POS处理）
            修剪块
                第一个块被修剪，作为侧链插入
                合并后父级被修剪，尝试恢复父级状态
                第一个块是未来的，将它和子孙放到未来队列里
                发生其他错误，中止
                循环处理区块
                    如果区块哈希被禁止，直接中止
                    检索父块及其在顶部执行的状态
                    启用预取以在处理的交易时可以拉入trie节点路径
                    使用父状态作为参考点来处理块（core/state_processor.go#Process）
                    验证状态转变后发生的变化是否合法（core/block_validator.go#ValidateState）
                    更新在区块处理和验证过程的统计信息
                    写入区块状态（core/blockchain.go#writeBlockWithState或者core/blockchain.go#writeBlockAndSetHead）
                        将块、元数据和相应的状态数据写入数据库（core/blockchain.go#writeBlockWithState）
                        将块、元数据和相应的状态数据写入数据库，并设置头部区块（core/blockchain.go#writeBlockAndSetHead）
                    更新在区块提交过程的统计信息
                    打印统计信息

# state

![state](assets/02/state.png)

蓝色的矩形代表本模块
    database主要提供了trie树的抽象，提供trie树的缓存和合约代码长度的缓存。
    journal主要提供了操作日志，以及操作回滚的功能。
    state_object是account对象的抽象，提供了账户的一些功能。
    statedb主要是提供了state trie的部分功能。

core/state_processor.go#Process（？？static call和call区别）

# bloom
eth/bloombits.go
